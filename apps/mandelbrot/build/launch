#!/bin/bash

SCRIPT_PATH="${BASH_SOURCE[0]}"
SCRIPT_DIR=`dirname "${SCRIPT_PATH}"`
cd "$SCRIPT_DIR"

# Process Mandelbrot-specific arguments: -P <aws-ec2-profile> and -I <aws-ec2-instance>

server_cmd='python ../webserver/mandelbrot_server.py --port=<<PORT>>'
profile_arg=0
instance_arg=0
launch_args=()
for arg in "$@"
do
  if [[ "$profile_arg" == "1" ]]
  then
    server_cmd="$server_cmd --profile $arg"
    profile_arg=0
  else
    if [[ "$instance_arg" == "1" ]]
    then
      server_cmd="$server_cmd --instance $arg"
      instance_arg=0
    else
      if [[ "$arg" == "-P" ]]
      then
        profile_arg=1
      else
        if [[ "$arg" == "-I" ]]
        then
          instance_arg=1
        else
          launch_args+=("$arg")
        fi
      fi
    fi
  fi
done

../../../framework/build/launch -w "$server_cmd" "${launch_args[@]}"

